#!/bin/bash
# Script to create a new release tag by incrementing the latest release version

set -e

# Fetch all tags from remote
git fetch --tags

# Get the latest tag that looks like a release (e.g., v1.2.3)
LATEST_TAG=$(git tag --list 'v[0-9]*.[0-9]*.[0-9]*' --sort=-v:refname | head -n 1)

if [[ -z "$LATEST_TAG" ]]; then
  # No tags found, start at v0.1.0
  NEW_TAG="v0.1.0"
else
  # Extract version numbers
  VERSION=${LATEST_TAG#v}
  IFS='.' read -r MAJOR MINOR PATCH <<< "$VERSION"
  PATCH=$((PATCH + 1))
  NEW_TAG="v${MAJOR}.${MINOR}.${PATCH}"
fi

echo "Latest tag: $LATEST_TAG"
echo "New tag: $NEW_TAG"

git tag "$NEW_TAG"
git push origin "$NEW_TAG"

echo "Release $NEW_TAG created and pushed."
